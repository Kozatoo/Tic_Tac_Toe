version: 0.2
# env:
#   secrets-manager:
#     RELEASE_KEY_PASSWORD: "arn:aws:secretsmanager:eu-west-3:654449453676:secret:prod/keystore-9cyoqE:keystore_password"
#     RELEASE_STORE_PASSWORD: "arn:aws:secretsmanager:eu-west-3:654449453676:secret:prod/keystore-9cyoqE:key_password"
phases:
  install:
    runtime-versions:
      android: 29
      java: corretto8
  build:
    commands:
      - aws s3 cp "s3://${S3_BUCKET}/keystore/key.keystore" ./
      - export RELEASE_STORE_FILE=../key.keystore  
      - export RELEASE_KEY_ALIAS=key
      -  ./gradlew bumperInit -PbumperVersionName=$(date +"%Y.%m.%d.%H") -PbumperVersionCode=$(date +"%H")  
      - ./gradlew assembleRelease
      - echo $KEY_PASSWORD > test.txt
artifacts:  
  files:
    - app/build/outputs/apk/release/*.apk
    - deploy.yml
    - test.txt
  type: zip
  discard-paths: yes
  override-packing: true
  name: applicationapk