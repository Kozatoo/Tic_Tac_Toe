version: 0.2
phases:
  install:
    runtime-versions:
      android: 29
      java: corretto8
  build:
    commands:
      - aws s3 cp s3://codepipeline-eu-west-3-841933358109/keystore/key.keystore ./
      - export RELEASE_STORE_FILE=../key.keystore  
      - export RELEASE_KEY_ALIAS=key
      - export RELEASE_STORE_PASSWORD=$KEY_STORE_PASSWORD
      - export RELEASE_KEY_PASSWORD=$KEY_PASSWORD
      - echo $( date +"%H") 
      - ./gradlew bumperInit -PversionName=$(date +"%Y.%m.%d.%H") -PversionCode=$(date +"%Y.%m.%d.%H")

      - ./gradlew assembleRelease

artifacts:  
  files:
    - app/build/outputs/apk/release/*.apk
  type: zip
  discard-paths: yes
  override-packing: true
  name: applicationapk